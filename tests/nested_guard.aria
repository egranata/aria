# SPDX-License-Identifier: Apache-2.0
import guard from aria.utils.guard;

struct Guard {
    type val COUNTER = 0;

    instance func guard_exit() {
        Guard.COUNTER = Guard.COUNTER + 1;
    }
}

func main() {
    val n = guard(alloc(Guard)).do(|x| => {
        val n = guard(alloc(Guard)).do(|y| => {
            return 1;
        })??;

        assert Guard.COUNTER == 1;
        return n + 1;
    })??;

    assert n == 2;
    assert Guard.COUNTER == 2;
}
