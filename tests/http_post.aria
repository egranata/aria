# SPDX-License-Identifier: Apache-2.0

### TAGS: FLAKEY

import Request from aria.network.request;
import JsonValue from aria.json.parser;
import * from aria.network.retry;

func main() {
    val request = Request.new("https://httpbin.org/post");

    val result = retry(|| => request.post("hello world"), |result| => result.status_code == 200);

    assert result.is_Pass();

    val json_result = JsonValue.parse(result.unwrap_Pass().content)!!;
    val json_map = json_result.unwrap_Object();
    val json_data = json_map["data"].unwrap_String();
    assert json_data == "hello world";
}
