# SPDX-License-Identifier: Apache-2.0
import aria.iterator.mixin;
import Instant from aria.date.instant;
import Path from aria.io.path;

func is_this_test(path) {
    return path.get_filename() == "dir_entries.aria";
}

func main() {
    val path = getenv("ARIA_TEST_DIR").unwrap_Some();
    val path = Path.new(path).new_canonical().unwrap_Ok();

    val entries = path.entries();
    entries = entries.iterator().where(is_this_test).to_list();

    assert entries.len() == 1;
    assert entries[0] isa Path;
    assert entries[0].is_file();
    assert entries[0].exists();
    assert entries[0].get_extension() == "aria";

    val creation = entries[0].created()!!;
    val modified = entries[0].modified();
    val accessed = entries[0].accessed()!!;

    assert creation.year >= 2025;
    assert modified.year >= 2025;
    assert accessed.year >= 2025;

    assert accessed.unix_ts >= modified.unix_ts;
    assert modified.unix_ts >= creation.unix_ts;

    if creation.year == 2025 {
        assert creation.month >= 7;

        if creation.month == 7 {
            assert creation.day >= 4;
        } else {
            assert creation.day >= 1;
        }
    } else {
        assert creation.month >= 1;
        assert creation.day >= 1;
    }
}
